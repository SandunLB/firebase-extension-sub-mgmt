document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("login-button"),t=document.getElementById("logout-button"),n=document.getElementById("user-info"),s=document.getElementById("login-container"),i=document.getElementById("user-name"),o=document.getElementById("user-email"),l=document.getElementById("user-avatar"),a=document.getElementById("status-message"),d=document.getElementById("subscription-status"),c=document.getElementById("subscription-options"),u=document.getElementById("manage-subscription"),y=document.getElementById("lifetime-message"),m=document.getElementById("monthly-plan"),r=document.getElementById("yearly-plan"),p=document.getElementById("lifetime-plan");function g(e){e?(i.textContent=e.displayName,o.textContent=e.email,l.src=e.photoURL||"default-avatar.png",n.style.display="block",s.style.display="none"):(n.style.display="none",s.style.display="block",d.textContent="Checking...",u.style.display="none",y.style.display="none")}function E(e){a.textContent="Initiating subscription...",chrome.runtime.sendMessage({action:"initiateSubscription",plan:e})}e.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"signIn"})})),t.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"signOut"})})),m.addEventListener("click",(()=>E("monthly"))),r.addEventListener("click",(()=>E("yearly"))),p.addEventListener("click",(()=>E("lifetime"))),u.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"openCustomerPortal"})})),chrome.runtime.onMessage.addListener(((e,t,n)=>{var s,i;"signInResult"===e.action?e.success?(g(e.user),i=e.user.uid,chrome.runtime.sendMessage({action:"checkSubscription",uid:i})):a.textContent="Sign-in failed. Please try again.":"signOutResult"===e.action?e.success?g(null):a.textContent="Sign-out failed. Please try again.":"subscriptionStatus"===e.action?(s=e.status)?(d.textContent=`${s.status} (${s.plan})`,"active"===s.status||"active_canceling"===s.status?(c.style.display="none",u.style.display="block",y.style.display="none","lifetime"===s.plan&&(u.style.display="none",y.style.display="block")):"expired"===s.status?(d.textContent="Expired",c.style.display="block",u.style.display="none",y.style.display="none"):(c.style.display="block",u.style.display="none",y.style.display="none")):(d.textContent="No active subscription",c.style.display="block",u.style.display="none",y.style.display="none"):"subscriptionExpired"===e.action&&(a.textContent="Your subscription has expired. Please renew to continue access.")})),chrome.runtime.sendMessage({action:"getAuthState"})}));